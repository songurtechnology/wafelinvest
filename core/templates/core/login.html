{% extends 'base.html' %}
{% load widget_tweaks %}

{% block title %}Giriş Yap - WafelInvest{% endblock %}

{% block content %}
<div class="container my-5">
  <div class="row justify-content-center">
    <div class="col-md-7 col-lg-6 col-xl-5">
      <div class="card shadow-lg border-0 rounded-4">
        <div class="card-header bg-primary text-white text-center rounded-top-4 py-4">
          <h2 class="fw-bold mb-0">Yatırım Paneline Giriş</h2>
        </div>
        <div class="card-body p-5">

          <p class="text-center text-muted mb-4 fs-6">
            Hesabınıza güvenli şekilde erişmek için bilgilerinizi girin.
          </p>

          {% if messages %}
            {% for message in messages %}
              <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert" aria-live="assertive">
                {{ message }}
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Kapat"></button>
              </div>
            {% endfor %}
          {% endif %}

          {% if form.errors %}
            <div class="alert alert-danger mb-4" role="alert" aria-live="assertive">
              Lütfen formu kontrol edin. Hatalı alanlar var.
            </div>
          {% endif %}

          <form method="post" action="{% url 'login' %}" novalidate class="needs-validation" aria-label="Giriş Formu">
            {% csrf_token %}

            <div class="form-floating mb-4 position-relative">
              {{ form.username|add_class:"form-control form-control-lg" | attr:"id:username,placeholder:Kullanıcı Adı" }}
              <label for="username" class="fw-semibold">Kullanıcı Adı <span class="text-danger">*</span></label>
              <div class="valid-feedback position-absolute end-0 top-50 translate-middle-y me-3">
                <i class="bi bi-check-circle-fill text-success fs-5"></i>
              </div>
              <div class="invalid-feedback">
                Lütfen kullanıcı adınızı giriniz.
              </div>
              {% for error in form.username.errors %}
                <div class="text-danger small mt-1" role="alert">{{ error }}</div>
              {% endfor %}
            </div>

            <div class="form-floating mb-5 position-relative">
              {{ form.password|add_class:"form-control form-control-lg" | attr:"id:password,placeholder:Şifre" }}
              <label for="password" class="fw-semibold">Şifre <span class="text-danger">*</span></label>
              <button type="button" class="btn btn-outline-secondary btn-sm position-absolute top-50 end-0 translate-middle-y me-2" id="togglePassword" aria-label="Şifreyi göster/gizle">
                <i class="bi bi-eye-fill"></i>
              </button>
              <div class="valid-feedback position-absolute end-0 top-50 translate-middle-y me-5">
                <i class="bi bi-check-circle-fill text-success fs-5"></i>
              </div>
              <div class="invalid-feedback">
                Lütfen şifrenizi giriniz.
              </div>
              {% for error in form.password.errors %}
                <div class="text-danger small mt-1" role="alert">{{ error }}</div>
              {% endfor %}
            </div>

            <button type="submit" class="btn btn-primary w-100 py-3 fw-semibold rounded-pill shadow-sm btn-hover-scale" aria-label="Giriş Yap ve Yatırım Paneline Eriş">
              Giriş Yap 🔐
            </button>
          </form>

          <p class="mt-4 text-center text-muted small">
            Hesabınız yok mu? <a href="{% url 'register' %}" class="text-decoration-none fw-semibold">Hemen Kayıt Olun</a>
          </p>
        </div>
      </div>
    </div>
  </div>
</div>

<style>
  .btn-hover-scale {
    transition: transform 0.3s ease, box-shadow 0.3s ease;
  }
  .btn-hover-scale:hover, .btn-hover-scale:focus {
    transform: scale(1.05);
    box-shadow: 0 0.5rem 1rem rgba(0,123,255,.5);
    outline: none;
  }
  .form-control:focus {
    border-color: #0d6efd;
    box-shadow: 0 0 0 0.25rem rgba(13,110,253,0.25);
  }
  .form-control.is-invalid {
    border-color: #dc3545;
    padding-right: calc(1.5em + 2.5rem);
    background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='%23dc3545' viewBox='0 0 12 12'%3e%3cpath d='M6.002 0a6 6 0 1 0 0 12 6 6 0 0 0 0-12zM5 3h2v4H5V3zm1 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2z'/%3e%3c/svg%3e");
    background-repeat: no-repeat;
    background-position: right 1rem center;
    background-size: 1rem 1rem;
  }
  .form-control.is-valid {
    padding-right: calc(1.5em + 2.5rem);
    background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='%23019800' viewBox='0 0 16 16'%3e%3cpath d='M13.485 1.929l-7.924 7.926-3.535-3.535-1.414 1.414 4.95 4.95 9.338-9.338-1.415-1.417z'/%3e%3c/svg%3e");
    background-repeat: no-repeat;
    background-position: right 1rem center;
    background-size: 1rem 1rem;
  }
</style>

<script>
  (function () {
    'use strict'

    var forms = document.querySelectorAll('.needs-validation')

    Array.prototype.slice.call(forms).forEach(function (form) {
      var usernameInput = form.querySelector('#username');
      var passwordInput = form.querySelector('#password');
      var togglePasswordBtn = document.getElementById('togglePassword');

      // Password show/hide toggle
      togglePasswordBtn.addEventListener('click', function () {
        const type = passwordInput.getAttribute('type') === 'password' ? 'text' : 'password';
        passwordInput.setAttribute('type', type);
        this.querySelector('i').classList.toggle('bi-eye-fill');
        this.querySelector('i').classList.toggle('bi-eye-slash-fill');
      });

      form.addEventListener('submit', function (event) {
        if (!form.checkValidity()) {
          event.preventDefault();
          event.stopPropagation();
        }
        form.classList.add('was-validated');
      });

      // Real-time validation feedback for inputs
      [usernameInput, passwordInput].forEach(input => {
        input.addEventListener('input', () => {
          if (input.checkValidity()) {
            input.classList.remove('is-invalid');
            input.classList.add('is-valid');
          } else {
            input.classList.remove('is-valid');
            input.classList.add('is-invalid');
          }
        });
      });
    });
  })()
</script>
{% endblock %}
